@model Ats.Models.Coupon.CouponViewModel;
@using Lpnet.WebApp.Resources
@{
    ViewBag.Title = @Resource.ViewBag_Title_Coupon_Edit;
        Layout = "~/Views/Shared/_Layout.cshtml"; 

}

@section styles{

    <link href="~/assets/libs/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
    <link href="~/assets/libs/select2/dist/css/select2.min.css" rel="stylesheet" type="text/css" />

}
@{
    SelectList CouponCategories = ViewBag.CouponCategories;
    SelectList ChannelCategories = ViewBag.ChannelCategories;
    SelectList StoreCategories = ViewBag.StoreCategories;

    SelectList CouponType = new SelectList(new List<SelectListItem>() {
        new SelectListItem() { Value = "true", Text = "Cash" },
        new SelectListItem() { Value = "false", Text = "Amount"},
    }, "Value", "Text", "true");
    SelectList ValidityPreiot = new SelectList(new List<SelectListItem>() {
            new SelectListItem() { Value = "true", Text = "Relative Date" },
            new SelectListItem() { Value = "false", Text = "Specific Date" },
    }, "Value", "Text", "true");
}

<div class="page-content">
    <div class="container-fluid">
        <div class="col-sm-6">
            <div class="page-title-box">
                <h4 class="font-size-18">@Resource.Sidebar_configurations_coupon</h4>
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Dashboard")">Panda Loyalty</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Campaign")">@Resource.Common_label_campaign</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Coupon")">@Resource.Sidebar_configurations_coupon</a></li>
                    <li class="breadcrumb-item"><a href="javascript: void(0);">@Resource.Common_label_edit</a></li>
                </ol>
            </div>
        </div>
        @using (Html.BeginForm("Edit", "Coupon", new { @class = "form-horizontal form-wizard-wrapper", role = "form" }, FormMethod.Post))
        {
            <!-- start page title -->

            <div class="col-sm-9">
                <h4 class="font-size-20">@Resource.Common_label_edit </h4>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <p class="badge badge-pill badge-success font-italic font-size-12">@ViewBag.StatusMessageProfile</p>

                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(model => model.Id)
                            <div class="row  ">
                                <div class="col-md-12 mt-1 ">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger">*</a> @Resource.Common_label_couponcode:</label>
                                        <div class="col-lg-6">
                                            @Html.TextBoxFor(m => m.CouponCode, new { placeholder = "", @class = "form-control", id = "txtPhoneNumber", name = "txtPhoneNumber" })
                                        </div>
                                        <div class="col-lg-4 mt-2">
                                            <input type="checkbox" value="" id="name" name="CouponName" /><a class="text-dark ml-1" href="#">@Resource.Common_label_autogenerated</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger">*</a> @Resource.Common_label_couponname:</label>
                                        <div class="col-lg-6">
                                            @Html.TextBoxFor(m => m.CouponName, new { placeholder = "", @class = "form-control", id = "txtEmailAddress", name = "txtEmailAddress" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-1">

                                <div class="col-md-12 mt-1  ">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger">*</a>  @Resource.Common_label_couponcategory:</label>
                                        <div class="col-lg-6">
                                            @Html.DropDownListFor(m => m.CouponCategoryId, CouponCategories, new { placeholder = "", @class = "form-control", id = "txtPhoneNumber", name = "txtPhoneNumber" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1 ">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger">*</a> @Resource.Common_label_coupontype:</label>
                                        <div class="col-lg-6">
                                            @Html.DropDownListFor(m => m.CouponType, CouponType, new { placeholder = "", @class = "form-control", id = "couponType", name = "txtEmailAddress" })

                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1 cashAmount">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger">*</a> @Resource.Common_label_cashamount:</label>
                                        <div class="col-lg-6">
                                            @Html.TextBoxFor(m => m.CashAmount, new { @class = "form-control text-center", @id = "cashAmount" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1 discount">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger">*</a> @Resource.Common_label_discountRate</label>
                                        <div class="col-lg-6">
                                            @Html.TextBoxFor(m => m.Discount, new { @class = "form-control text-center", @id = "discount" })
                                        </div>
                                        <div class="mt-2"><lable clas=""></lable></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-1">
                                <div class="col-md-12 mt-1 ">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 text-left"><a class="text-danger"></a>@Resource.Common_label_redemptionconditions:</label>
                                        <div class="col-6">
                                            <div class="row">
                                                <label for="txtPhoneNumber" class="text-left col-3 font-weight-light"><a class="text-danger"></a>@Resource.Common_label_minimumpurchaseof:</label>
                                                <div class=" col-9">
                                                    @Html.TextBoxFor(m => m.MinimumPurchase, new { @class = "input-qty text-center", @id = "txt_start_from", @ariaLabel = "quantity", @max = "100", @min = "0" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1 validityPeriodType">
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger"></a>@Resource.Common_label_validityperiot:</label>
                                        <div class="col-lg-6">
                                            @Html.DropDownListFor(m => m.ValidityPeriodType, ValidityPreiot, new { placeholder = "", @class = "form-control", @href = "", id = "ValidityPeriodType", name = "ValidityPeriodType" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 mt-1 relativeDate ">
                                    <!-- Relative Date / Start From-->
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 text-left"><a class="text-danger"></a></label>
                                        <div class="col-6">
                                            <div class="row">
                                                <label for="txtPhoneNumber" class="text-left col-3 font-weight-light"><a class="text-danger"></a>@Resource.Common_label_startfrom:</label>
                                                <div class=" col-9">
                                                    @Html.TextBoxFor(m => m.AfterReceptionDay, new { @class = "form-control text-center", @id = "afterReceptionDay" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-2 mt-2"><a>  @Resource.Common_label_dayafterreception</a></div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1  relativeDate ">
                                    <!-- Relative Date / End To-->
                                    <div class="form-group row">
                                        <label for="txtPhoneNumber" class="col-lg-2 text-left"><a class="text-danger"></a></label>
                                        <div class="col-6">
                                            <div class="row">
                                                <label for="txtPhoneNumber" class="text-left col-3 font-weight-light"><a class="text-danger"></a>@Resource.Common_label_endto:</label>
                                                <div class=" col-9">
                                                    @Html.TextBoxFor(m => m.AfterEffectiveDay, new { @class = "form-control text-center", @id = "afterEffectiveDay" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-2 mt-2"><a>   @Resource.Common_label_dayaftereffective</a></div>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-1 specificDate ">
                                    <!-- Specific Date-->
                                    <div class="form-group row ">
                                        <label for="txtPhoneNumber" class="col-lg-2 col-form-label text-left"><a class="text-danger"></a></label>
                                        <div class="col-lg-6">
                                            <div class="row">
                                                <div class="col-5">
                                                    @if (Model.EffectiveDateBegin == null)
                                                    {
                                                        @Html.TextBoxFor(m => m.EffectiveDateBegin, "{0:yyyy-MM-dd}", new { placeholder = "", @class = "form-control", id = "effectiveDateBegin", type = "date", name = "effectiveDateBegin" })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(m => m.EffectiveDateBegin, "{0:yyyy-MM-dd}", new { placeholder = "", @class = "form-control", id = "effectiveDateBegin", type = "date", name = "effectiveDateBegin" })
                                                    }
                                                </div>
                                                <div class="col-2 mt-1 text-center"><a class=""><i class="fas fa-arrow-right"></i></a></div>
                                                <div class="col-5">
                                                    @Html.TextBoxFor(m => m.EffectiveDateEnd, "{0:yyyy-MM-dd}", new { placeholder = "", @class = "form-control", id = "effectiveDateEnd", type = "date", name = "effectiveDateEnd" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 mt-1">
                                    <label for="" class="text-left"><a class="text-danger">*</a>@Resource.Common_label_termsconditions:</label>
                                </div>
                                <div class="col-md-9">
                                    @Html.TextAreaFor(m => m.TermAndConditions, new { placeholder = "", @class = "form-control", id = "txtEmailAddress", name = "txtEmailAddress" })
                                </div>
                            </div>
                            <div class="row mt-2 ml-1">
                                 <a href="@Url.Action("Index", "Coupon")" class="text-white btn btn-primary waves-effect waves-light col-md-3 mt-3 mr-2">@Resource.Common_label_cancel</a> 
                                <button type="submit" class="btn btn-primary waves-effect waves-light col-md-3 mt-3">@Resource.Common_label_save</button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div> <!-- container-fluid -->
</div>
<!-- End Page-content -->


@section scripts{
    <script>
        var occupationDetail = '/TagMemberTag/Detail';
        $(function () {
            $(".tag-detail").click(function () {
                var $buttonClicked = $(this);
                var id = $buttonClicked.attr('data-id');
                $.ajax({
                    type: "GET",
                    url: occupationDetail,
                    contentType: "application/json; charset=utf-8",
                    data: { "Id": id },
                    datatype: "json",
                    success: function (data) {
                        $('#myModalContent').html(data);
                        $('#editModal').modal('show');

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
        });


    </script>
    <script>
        $('input.input-qty').each(function () {
            var $this = $(this),
                qty = $this.parent().find('.is-form'),
                min = Number($this.attr('min')),
                max = Number($this.attr('max'))
            if (min == 0) {
                var d = 0
            } else d = min
            $(qty).on('click', function () {
                if ($(this).hasClass('minus')) {
                    if (d > min) d += -1
                } else if ($(this).hasClass('plus')) {
                    var x = Number($this.val()) + 1
                    if (x <= max) d += 1
                }
                $this.attr('value', d).val(d)
            })
        })
    </script>

    <script>
        var couponType = $("#couponType option:selected").val();
        console.log(couponType);
        if (couponType == 'true') {
            $(".cashAmount").show();
            $(".discount").hide();
        } else {
            $(".cashAmount").hide();
            $(".discount").show();
        }
        $("#couponType").on('change', function () {
            if (this.value == 'true') {
                $(".cashAmount").show();
                $(".discount").hide();
            } else {
                $(".cashAmount").hide();
                $(".discount").show();
            }
        });
    </script>
    <script>
        var ValidityPeriodType = $("#ValidityPeriodType option:selected").val();
        console.log(couponType);
        if (ValidityPeriodType == 'true') {
            $(".relativeDate").show();
            $(".specificDate").hide();
        } else {
            $(".relativeDate").hide();
            $(".specificDate").show();
        }
        $("#ValidityPeriodType").on('change', function () {
            if (this.value == 'true') {
                $(".relativeDate").show();
                $(".specificDate").hide();
            } else {
                $(".relativeDate").hide();
                $(".specificDate").show();
            }
        });
    </script>

    <script src="~/assets/libs/select2/dist/js/select2.min.js"></script>
    <script src="~/assets/libs/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>

    <script>
        $("input[name='AfterReceptionDay']").TouchSpin({
            min: 0,
            max: 100,
            stepinterval: 18,
            maxboostedstep: 100,
            prefix: ''
        });
        $("input[name='CashAmount']").TouchSpin({
            min: 0,
            max: 10000000,
            step: 1000,
            initval: 0,
            stepinterval: 30,
            maxboostedstep: 1,
            prefix: ''
        });

        $("input[name='Discount']").TouchSpin({
            min: 0,
            max: 100,
            step: 0.1,
            decimals: 2,
            boostat: 5,
            maxboostedstep: 10,
            postfix: '%'
        });
        $("input[name='MinimumPurchase']").TouchSpin({
            min: 0,
            max: 100,
            stepinterval: 0,
            maxboostedstep: 10000000,
            prefix: ''
        });

        $("input[name='AfterReceptionDay']").TouchSpin({
            min: 0,
            max: 100,
            stepinterval: 18,
            maxboostedstep: 100,
            prefix: ''
        });
        $("input[name='AfterEffectiveDay']").TouchSpin({
            min: 0,
            max: 10000000,
            stepinterval: 100,
            maxboostedstep: 10000000,
            prefix: ''
        });

    </script>
}